<!DOCTYPE html>
<html lang="en">
  <head>
    <base href="/MySqlConnector/" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Documentation for MySqlConnector: an Async MySQL Driver for .NET and .NET Core">
    <meta name="author" content="MySqlConnector Authors">
    
    <link rel="apple-touch-icon" sizes="57x57" href="img/icons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="img/icons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="img/icons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="img/icons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="img/icons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="img/icons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="img/icons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="img/icons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="img/icons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="img/icons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="img/icons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/icons/favicon-16x16.png">
    <link rel="manifest" href="img/icons/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    

    <meta name="generator" content="Hugo 0.17" />
    
    <title>MySqlConnector - Best Practices</title>

    <link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="vendor/font-awesome/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="vendor/prism/css/prism.css" />
    <link rel="stylesheet" type="text/css"  href="css/style.css" rel="stylesheet" />

  </head>

  <body>

    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <div class="col-xs-8 navbar-mysqlc-logo">
                <a href="">
                    <img alt="MySqlConnector" src="img/icons/favicon-32x32.png" />
                </a>
                <a href="">
                    MySqlConnector
                </a>
            </div>
            <div class="col-xs-4 navbar-mysqlc-gh">
                <a href="https://github.com/mysql-net/MySqlConnector">
                    <i class="fa fa-github"></i> View on GitHub
                </a>
            </div>
    </nav>

    <div class="container">
        <div class="row">
            
<div class="col-md-3">
    <div class="list-group" id="navigation" data-spy="affix" data-offset-top="0">

        
        <a class="list-group-item" href="" data-parent="#navigation">
            <i class='fa fa-home'></i> <span>Home</span> 
        </a>

        

        
        <a class="list-group-item" href="#nav-1" data-parent="#navigation" data-toggle="collapse">
            <i class='fa fa-road'></i> <span>Getting Started</span> <i class="fa fa-angle-down"></i>
        </a>

        
        <div id="nav-1" class="submenu panel-collapse collapse ">
            
            <a class="list-group-item" data-parent="#nav-1" href="/MySqlConnector/overview/installing/">
                <span>Installing</span>
            </a>
            
            <a class="list-group-item" data-parent="#nav-1" href="/MySqlConnector/overview/configuration/">
                <span>Configuration</span>
            </a>
            
            <a class="list-group-item" data-parent="#nav-1" href="/MySqlConnector/overview/use-with-orms/">
                <span>Use with ORMs</span>
            </a>
            
        </div>
        

        
        <a class="list-group-item" href="/MySqlConnector/connection-options/" data-parent="#navigation">
            <i class='fa fa-bolt'></i> <span>Connection Options</span> 
        </a>

        

        
        <a class="list-group-item active" href="#nav-3" data-parent="#navigation" data-toggle="collapse">
            <i class='fa fa-lightbulb-o'></i> <span>Tutorials</span> <i class="fa fa-angle-down"></i>
        </a>

        
        <div id="nav-3" class="submenu panel-collapse collapse  in">
            
            <a class="list-group-item active" data-parent="#nav-3" href="/MySqlConnector/tutorials/best-practices/">
                <span>Best Practices</span>
            </a>
            
            <a class="list-group-item" data-parent="#nav-3" href="/MySqlConnector/tutorials/migrating-from-connector-net/">
                <span>Migrating from Connector/NET</span>
            </a>
            
            <a class="list-group-item" data-parent="#nav-3" href="/MySqlConnector/tutorials/net-core-mvc/">
                <span>Use with .NET MVC</span>
            </a>
            
        </div>
        

        
        <a class="list-group-item" href="#nav-4" data-parent="#navigation" data-toggle="collapse">
            <i class='fa fa-file-text'></i> <span>API</span> <i class="fa fa-angle-down"></i>
        </a>

        
        <div id="nav-4" class="submenu panel-collapse collapse ">
            
            <a class="list-group-item" data-parent="#nav-4" href="/MySqlConnector/api/mysql-db-connection/">
                <span>MySqlDbConnection</span>
            </a>
            
            <a class="list-group-item" data-parent="#nav-4" href="/MySqlConnector/api/mysql-db-command/">
                <span>MySqlDbCommand</span>
            </a>
            
            <a class="list-group-item" data-parent="#nav-4" href="/MySqlConnector/api/mysql-db-data-reader/">
                <span>MySqlDbDataReader</span>
            </a>
            
            <a class="list-group-item" data-parent="#nav-4" href="/MySqlConnector/api/mysql-db-transaction/">
                <span>MySqlDbTransaction</span>
            </a>
            
        </div>
        

        
    </div>
</div>

            <div class="col-md-9">




<h1 id="best-practices">Best Practices</h1>

<h2 id="asynchronous-operation">Asynchronous Operation</h2>

<p>MySqlConnector is fully asynchronous, supporting the async ADO.NET methods added in .NET 4.5 without blocking
or using <code>Task.Run</code> to run synchronous methods on a background thread.  Programmers implementing MySqlConnector
should be familiar with <a href="https://msdn.microsoft.com/en-us/magazine/jj991977.aspx">Async/Await - Best Practices in Asynchronous Programming</a>.</p>

<h3 id="always-use-async-when-possible">Always Use Async when possible</h3>

<table class="table table-bordered table-head-centered" style="max-width: 650px">
  <thead>
    <th style="width:30%">ADO.NET Class</th>
    <th class="success" style="width:40%">Asynchronous Method<br />(always use when possible)</th>
    <th class="warning" style="width:30%">Synchronous Method<br />(avoid when possible)</th>
  </thead>
  <tr>
    <td rowspan="2" style="vertical-align:middle">
      <a href="https://docs.microsoft.com/en-us/dotnet/core/api/system.data.common.dbconnection">DbConnection</a>
    </td>
    <td>OpenAsync</td>
    <td>Open</td>
  </tr>
  <tr>
    <td>
      <span class="text-danger">*</span><a href="api/mysql-db-connection">MySqlDbConnection</a>.BeginTransactionAsync
    </td>
    <td>BeginTransaction</td>
  </tr>
  <tr>
    <td rowspan="3" style="vertical-align:middle">
      <a href="https://docs.microsoft.com/en-us/dotnet/core/api/system.data.common.dbcommand">DbCommand</a>
    </td>
    <td>ExecuteNonQueryAsync</td>
    <td>ExecuteNonQuery</td>
  </tr>
  <tr>
    <td>ExecuteReaderAsync</td>
    <td>ExecuteReader</td>
  </tr>
  <tr>
    <td>ExecuteScalarAsync</td>
    <td>ExecuteScalar</td>
  </tr>
  <tr>
    <td rowspan="4" style="vertical-align:middle">
      <a href="https://docs.microsoft.com/en-us/dotnet/core/api/system.data.common.dbdatareader">DbDataReader</a>
    </td>
    <td>GetFieldValueAsync</td>
    <td>GetFieldValue</td>
  </tr>
  <tr>
    <td>IsDBNullAsync</td>
    <td>IsDBNull</td>
  </tr>
  <tr>
    <td>NextResultAsync</td>
    <td>NextResult</td>
  </tr>
  <tr>
    <td>ReadAsync</td>
    <td>Read</td>
  </tr>
  <tr>
    <td rowspan="2" style="vertical-align:middle">
      <a href="https://docs.microsoft.com/en-us/dotnet/core/api/system.data.common.dbtransaction">DbTransaction</a>
    </td>
    <td>
      <span class="text-danger">*</span><a href="api/mysql-db-transaction">MySqlDbTransaction</a>.CommitAsync
    </td>
    <td>Commit</td>
  </tr>
  <tr>
    <td>
      <span class="text-danger">*</span><a href="api/mysql-db-transaction">MySqlDbTransaction</a>.RollbackAsync
    </td>
    <td>Rollback</td>
  </tr>
</table>

<p><span class="text-danger">*</span>Async Transaction methods are not part of ADO.NET, they are provided by
MySqlConnector to allow database code to remain fully asynchronous.</p>

<h3 id="example-console-application">Example Console Application</h3>

<p>In order to get the full benefit of asynchronous operation, every method in the call stack that eventually calls
MySqlConnector should be implemented as an async method.  The exception is the <code>static void Main</code> method in a Console Application.</p>

<p>Example assumes a <a href="overview/configuration">configured AppDb</a> object in the <code>MySqlConnector.Examples</code> namespace.</p>

<pre><code class="language-csharp">using System.Threading.Tasks;
using System.Collections.Generic;

namespace MySqlConnector.Examples
{
    public class Program
    {
        public static void Main(string[] args)
        {
            MainAsync(args).GetAwaiter().GetResult();
        }

        public static async Task MainAsync(string[] args)
        {
            var tasks = new List&lt;Task&gt;();
            for (var i=0; i&lt;100; i++){
                tasks.Add(Controllers.SleepOne());
            }
            // these 100 queries should all complete in around
            // 1 second if &quot;Max Pool Size=100&quot; (the default)
            await Task.WhenAll(tasks);
        }
    }

    public class Controllers
    {
        public static async Task SleepOne()
        {
            using (var db = new AppDb())
            {
                await db.OpenAsync();
                var cmd = db.Connection.CreateCommand();
                cmd.CommandText = @&quot;SELECT SLEEP(1)&quot;;
                await cmd.ExecuteNonQueryAsync();
            }
        }
    }
}
</code></pre>

<h2 id="synchronous-operation">Synchronous Operation</h2>

<div class="alert alert-warning">
  Using Synchronous Methods can have adverse effects on the managed thread pool and cause slowdowns or lock-ups
  if not properly tuned.  The recommended approach is to use all Asynchronous Methods.
</div>

<p>If you must use synchronous methods, ensure that your thread pool is at least the size of the number of
concurrent connections you plan to support.  For example, if you are creating a web server using
synchronous methods that needs to support serving 500 Requests Per Second, set the minimum thread
pool size to 500.</p>

<p>Example <code>project.json</code> configuration:</p>

<pre><code class="language-json">{
  &quot;runtimeOptions&quot;: {
    &quot;configProperties&quot;: {
      &quot;System.GC.Server&quot;: true,
      &quot;System.GC.Concurrent&quot;: true,
      &quot;System.Threading.ThreadPool.MinThreads&quot;: 500
    }
  },
  // other config
}
</code></pre>



          <div id="prevNext">
            
              
              
              
            
              
              
              
                
                
                
              
                
                
                
              
                
                
                
              
            
              
              
              
            
              
              
              
                
                
                  
                  
                
                
              
                
            <div class="pull-right">
              <a  href="/MySqlConnector/tutorials/migrating-from-connector-net/">
                  Migrating from Connector/NET <i class="fa fa-angle-right"></i>
              </a>
            </div>
                  
                
                
                
              
                
                
                
              
            
              
              
              
                
                
                
              
                
                
                
              
                
                
                
              
                
                
                
              
            
            <div class="clearfix"></div>
        </div>
        
      </div>
      
    </div>
    

    <footer class="footer">
      <div class="container-fluid">
        <div class="row">
          <div id="footerContent" class="col-sm-12">
            Free and open source under the
            <a href="https://github.com/mysql-net/MySqlConnector/blob/master/LICENSE">MIT License</a>
          </div>
        </div>
      </div>
    </footer>

    
    <script type="text/javascript" src="vendor/jquery/js/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="vendor/prism/js/prism.js"></script>
  </body>
</html>

